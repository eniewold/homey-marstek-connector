{
  "id": "com.niewold.marstek",
  "version": "0.7.0",
  "compatibility": ">=12.4.5",
  "sdk": 3,
  "brandColor": "#555555",
  "platforms": [
    "local"
  ],
  "name": {
    "en": "Marstek Battery Connector"
  },
  "description": {
    "en": "Monitor, control and automate your Marstek home battery"
  },
  "category": [
    "energy"
  ],
  "permissions": [],
  "images": {
    "small": "/assets/images/small.jpg",
    "large": "/assets/images/large.jpg",
    "xlarge": "/assets/images/xlarge.jpg"
  },
  "author": {
    "name": "Edward Niewold",
    "email": "edward@niewold.com"
  },
  "source": "https://github.com/eniewold/homey-marstek-connector",
  "homeyCommunityTopicId": 143139,
  "drivers": [
    {
      "name": {
        "en": "Marstek Venus (API)"
      },
      "class": "battery",
      "capabilities": [
        "battery_charging_state",
        "meter_power",
        "meter_power.imported",
        "meter_power.exported",
        "meter_power.load",
        "measure_power",
        "measure_power_ongrid",
        "measure_power_offgrid",
        "measure_temperature",
        "measure_battery",
        "last_message_received"
      ],
      "energy": {
        "homeBattery": true,
        "meterPowerImportedCapability": "meter_power.imported",
        "meterPowerExportedCapability": "meter_power.exported"
      },
      "capabilitiesOptions": {
        "meter_power.imported": {
          "title": {
            "en": "Charged (grid)"
          }
        },
        "meter_power.exported": {
          "title": {
            "en": "Discharged (grid)"
          }
        },
        "meter_power.load": {
          "title": {
            "en": "Load (or off-grid) consumed"
          }
        }
      },
      "platforms": [
        "local"
      ],
      "connectivity": [
        "lan"
      ],
      "images": {
        "small": "/drivers/marstek-venus/assets/images/small.png",
        "large": "/drivers/marstek-venus/assets/images/large.png",
        "xlarge": "/drivers/marstek-venus/assets/images/xlarge.png"
      },
      "pair": [
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_devices"
          },
          "options": {
            "multiple": true
          }
        },
        {
          "id": "add_devices",
          "template": "add_devices"
        }
      ],
      "id": "marstek-venus",
      "settings": [
        {
          "id": "debug",
          "type": "checkbox",
          "label": {
            "en": "Enable more logging (for diagnostics reports)"
          },
          "hint": {
            "en": "Turn this on to log extra details for troubleshooting received values for this device."
          },
          "value": false
        },
        {
          "id": "src",
          "type": "label",
          "label": {
            "en": "Source label of UDP messages"
          },
          "value": ""
        },
        {
          "id": "port",
          "type": "label",
          "label": {
            "en": "UDP Port number"
          },
          "value": "30000",
          "hint": {
            "en": "This Homey App requires all batteries listed to port 30000"
          }
        },
        {
          "id": "model",
          "type": "label",
          "label": {
            "en": "Model name"
          },
          "value": "(model)"
        },
        {
          "id": "firmware",
          "type": "label",
          "label": {
            "en": "Firmware"
          },
          "value": "(unknown)"
        }
      ]
    },
    {
      "name": {
        "en": "Marstek Venus (Cloud)"
      },
      "class": "battery",
      "capabilities": [
        "measure_battery",
        "measure_power",
        "measure_power.charge",
        "measure_power.discharge",
        "last_message_received"
      ],
      "energy": {
        "homeBattery": true
      },
      "capabilitiesOptions": {
        "measure_power": {
          "title": {
            "en": "Power Grid (W)"
          }
        },
        "measure_power.charge": {
          "title": {
            "en": "Charge Grid (W)"
          }
        },
        "measure_power.discharge": {
          "title": {
            "en": "Discharge Grid (W)"
          }
        }
      },
      "platforms": [
        "local"
      ],
      "connectivity": [
        "cloud"
      ],
      "images": {
        "small": "/drivers/marstek-venus-cloud/assets/images/small.png",
        "large": "/drivers/marstek-venus-cloud/assets/images/large.png",
        "xlarge": "/drivers/marstek-venus-cloud/assets/images/xlarge.png"
      },
      "pair": [
        {
          "id": "login_credentials",
          "template": "login_credentials",
          "options": {
            "title": {
              "en": "Sign in to your Marstek account"
            },
            "usernameLabel": {
              "en": "E-mail"
            },
            "passwordLabel": {
              "en": "Password"
            },
            "buttonLabel": {
              "en": "Sign in"
            }
          }
        },
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_devices"
          },
          "options": {
            "multiple": false
          }
        },
        {
          "id": "add_devices",
          "template": "add_devices"
        }
      ],
      "id": "marstek-venus-cloud",
      "settings": [
        {
          "id": "debug",
          "type": "checkbox",
          "label": {
            "en": "Enable more logging (for diagnostics reports)"
          },
          "hint": {
            "en": "Turn this on to log extra details for troubleshooting received values for this device."
          },
          "value": false
        },
        {
          "id": "username",
          "type": "label",
          "label": {
            "en": "Account"
          },
          "value": "(unknown)"
        }
      ]
    }
  ],
  "flow": {
    "actions": [
      {
        "id": "marstek_auto_mode_on",
        "title": {
          "en": "Turn battery mode 'Auto' On"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_auto_mode_off",
        "title": {
          "en": "Turn battery mode 'Auto' Off"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_ai_mode_on",
        "title": {
          "en": "Turn battery mode 'AI' On"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_ai_mode_off",
        "title": {
          "en": "Turn battery mode 'AI' Off"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_manual_mode_on",
        "title": {
          "en": "Turn battery mode 'Manual' On"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_manual_mode_off",
        "title": {
          "en": "Turn battery mode 'Manual' Off"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_passive_mode_on",
        "title": {
          "en": "Turn battery mode 'Passive' On"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_passive_mode_off",
        "title": {
          "en": "Turn battery mode 'Passive' Off"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          }
        ]
      },
      {
        "id": "marstek_passive_mode_set",
        "title": {
          "en": "Set battery 'Passive' mode to [[power]] W for [[seconds]] seconds"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=marstek-venus"
          },
          {
            "name": "power",
            "type": "number",
            "label": {
              "en": "Power (W)"
            },
            "min": 0,
            "step": 1
          },
          {
            "name": "seconds",
            "type": "number",
            "label": {
              "en": "Seconds"
            },
            "min": 0,
            "step": 1
          }
        ]
      }
    ]
  },
  "capabilities": {
    "last_message_received": {
      "type": "number",
      "title": {
        "en": "Data age (sec)"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "insights": false,
      "icon": "/assets/clock-outline-badged.svg"
    },
    "measure_power_offgrid": {
      "type": "number",
      "title": {
        "en": "Off-Grid power"
      },
      "units": {
        "en": "W"
      },
      "getable": true,
      "setable": false,
      "decimals": 2,
      "uiComponent": "sensor",
      "icon": "/assets/disconnect.svg"
    },
    "measure_power_ongrid": {
      "type": "number",
      "title": {
        "en": "On-Grid power"
      },
      "units": {
        "en": "W"
      },
      "getable": true,
      "setable": false,
      "decimals": 2,
      "uiComponent": "sensor",
      "icon": "/assets/connect.svg"
    },
    "measure_power_pv": {
      "type": "number",
      "title": {
        "en": "Solar power"
      },
      "units": {
        "en": "W"
      },
      "getable": true,
      "setable": false,
      "decimals": 2,
      "uiComponent": "sensor",
      "icon": "/assets/sun.svg"
    }
  }
}