<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <header class="homey-header">
        <p class="homey-title" data-i18n="settings.title">
            <!-- This will be filled with the translated string with key 'settings.subtitle'. -->
        </p>
        <p class="homey-subtitle" data-i18n="settings.subtitle">
            <!-- This will be filled with the translated string with key 'settings.subtitle'. -->
        </p>
    </header>

    <form class="homey-form">
        <div class="homey-form-group">
            <!-- device address -->
            <fieldset class="homey-form-fieldset">
                <label class="homey-form-label" for="deviceAddress" data-i18n="settings.deviceAddress"></label>
                <input class="homey-form-input" id="deviceAddress" type="text" placeholder="192.168.1.100" />
            </fieldset>
            <!-- device port -->
            <fieldset class="homey-form-fieldset">
                <label class="homey-form-label" for="devicePort" data-i18n="settings.devicePort"></label>
                <input class="homey-form-input" id="devicePort" type="number" placeholder="30000" min="1" max="65535" />
            </fieldset>
            <!-- polling interval -->
            <fieldset class="homey-form-fieldset">
                <label class="homey-form-label" for="pollInterval" data-i18n="settings.pollInterval"></label>
                <input class="homey-form-input" id="pollInterval" type="number" value="60" min="15" />
            </fieldset>
            <!-- Enable/disable periodic polling -->
            <fieldset class="homey-form-checkbox-set">
                <label class="homey-form-checkbox">
                    <input class="homey-form-checkbox-input" type="checkbox" id="pollEnabled" checked />
                    <span class="homey-form-checkbox-checkmark"></span>
                    <span class="homey-form-checkbox-text" data-i18n="settings.pollEnabled"></span>
                </label>
            </fieldset>
        </div>
    </form>

    <script>
        const elemAddress = document.getElementById('deviceAddress');
        const elemPort = document.getElementById('devicePort');
        const elemInterval = document.getElementById('pollInterval');
        const elemEnabled = document.getElementById('pollEnabled');

        // Received with current/default values after view is shown
        Homey.on("initPollSettings", function (msg) {
            elemInterval.value = msg.interval;
            elemEnabled.checked = !!msg.enabled;
        });

        // Change setting immediately on any change
        elemAddress.addEventListener('change', async (event) => {
            const address = elemAddress.value.trim();
            await Homey.emit('saveDeviceAddress', address);
        });
        elemPort.addEventListener('change', async (event) => {
            const port = parseInt(elemPort.value, 10);
            await Homey.emit('saveDevicePort', port);
        });
        elemInterval.addEventListener('change', async (event) => {
            const frequency = parseInt(elemInterval.value, 10);
            await Homey.emit('savePollInterval', frequency);
        });
        elemEnabled.addEventListener('change', async (event) => {
            const enabled = !!elemEnabled.checked;
            await Homey.emit('savePollEnabled', enabled);
        });
    </script>
</body>
</html>